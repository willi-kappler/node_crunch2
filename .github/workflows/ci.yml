name: Build Matrix

on:
  # Allows manual triggering
  workflow_dispatch:

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        # Define the base sets here to ensure they multiply
        os: [ubuntu-latest, windows-latest, macos-latest]
        mode: [debug, release]
        include:
          # Map specific compilers to the OS
          - os: ubuntu-latest
            cc: gcc
            cxx: g++
          - os: ubuntu-latest
            cc: clang
            cxx: clang++
          - os: windows-latest
            # On Windows, both are just 'cl'
            cc: cl
            cxx: cl
          - os: macos-latest
            cc: clang
            cxx: clang++

    runs-on: ${{ matrix.os }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Add MSVC to PATH
        if: matrix.os == 'windows-latest'
        uses: ilammy/msvc-dev-cmd@v1

      # 1. Install xmake
      - name: Setup xmake
        uses: xmake-io/github-action-setup-xmake@v1
        with:
          xmake-version: latest

      # 2. Configure
      - name: Configure
        run:
          xmake global --clean
          xmake f -m ${{ matrix.mode }} --cc=${{ matrix.cc }} --cxx=${{ matrix.cxx }} -y

      # 3. Build
      - name: Build
        run: xmake
